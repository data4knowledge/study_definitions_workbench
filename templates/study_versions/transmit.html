{% extends "shared/_main_layout.html" %}
{% block environment_content %}
  {% with request=request %}
    {% include "shared/partials/environment.html" %}
  {% endwith %}    
{% endblock %}
{% block user_content %}
  {% with request=request, user=user %}
    {% include "shared/partials/user.html" %}
  {% endwith %}    
{% endblock %}
{% block menu_content %}
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">
      <i class="bi bi-box-arrow-in-down me-2"></i>Export
    </a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="/versions/{{data['version']['id']}}/export/fhir">Download FHIR Message (JSON)</a>
      <a class="dropdown-item" href="/versions/{{data['version']['id']}}/export/protocol">Download Protocol (PDF)</a>
    </div>
  </li>
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">
      <i class="bi bi-send me-2"></i>Transmit
    </a>
    <div class="dropdown-menu">
      {% if data['endpoints']['count'] == 0 %}
        <a class="dropdown-item" href="#">No endpoints available, you need to create one or more</a>
      {% else %}
        {% for item in data['endpoints']['items'] %}
          {% set id = "tab-" ~ loop.index0 ~ "_div" %}
          <a class="dropdown-item" href="/versions/{{data['version']['id']}}/transmit/{{item['id']}}">{{item['name']}}</a>
        {% endfor %}
      {% endif %}
    </div>
  </li>
{% endblock %}

{% block main_content %}
  {% set sponsor = data['version']['identifiers']['Clinical Study Sponsor'] %}
  <div class="mt-3 row">
    <div class="col-12">
      <div class="card card-body rounded-3 shadow-sm">
        <div class="row mt-2">
          <h4 class="card-title">{{data['version']['titles']['Official Study Title']}}</h4>
          <h6 class="card-subtitle mb-2 text-muted">Sponsor: {{sponsor['studyIdentifierScope']['name']}} | Phase: {{data['version']['phase']['standardCode']['decode']}} | Identifier: {{sponsor['studyIdentifier']}} | Version: {{data['version']['version_identifier']}}</h6>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-3 row">
    <div class="col-12">
      <div class="card card-body rounded-3 h-100">
        <div class="mt-3" id="json_div">
          <pre>{{data['response']}}</pre>
          <a href="/versions/{{data['version']['id']}}/summary" >
            <button type="submit" class="btn btn-outline-primary rounded-5 mt-3">
              <i class="bi bi-send me-2"></i>
              Return to the main summary window
            </button>
          </a>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
